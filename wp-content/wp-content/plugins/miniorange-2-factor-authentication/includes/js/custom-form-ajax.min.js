jQuery(document).ready(function(){let e=jQuery,t=otpverificationObj.siteURL,i=otpverificationObj.nonce,n=otpverificationObj.submitSelector,o=otpverificationObj.formname,l=otpverificationObj.emailselector,a=otpverificationObj.phoneSelector,r="",s="",d=!1,c=!1,p=otpverificationObj.authType,u=otpverificationObj.isEnabledShortcode,b=otpverificationObj.isRegistered;const m='<input type="text"name="edit_otp"id="edit_otp"placeholder="Enter the OTP you have received"style="display:none;"><br>',f='<br><p id="otpmessage"> An OTP will be sent to your Mobile Number</p>',v=' <p id="otpmessage">An OTP will be sent to your Mobile Number and Email</p>',g='<br><p id="otpmessage"> An OTP will be sent to your Email ID</p>',h='<div class="button" id ="otp_send_button">Send OTP</div> <div class="button" id ="timer" style="visibility:hidden;">00</div><br><br>';if("false"===b){const t='<p id="registermessage" style="color: red;font-size: 18px;border: red 1px solid;padding: 5px" > miniOrange : Register/Login with miniOrange to Enable 2FA for this Form</p>';e(l).after("<br>"+t)}else if((e(o).length||e(n).length)&&!1!==b&&"false"!==u){let u,b,A;function _(t,i){e("#otpmessage").text(""),e("#otpmessage").text(t).css("color",i)}function x(t,i,n,o,l){r="";let a,d=0,p={action:"mo_shortcode",mo_action:"challenge",email:n,phone:i,nonce:o,authTypeSend:t};e("#otp_send_button").text("Sending"),e.post(l,p,function(t){if(null===t)_("Contact Site Administrator","red");else switch(t.status){case"SUCCESS":function i(){0===d?(clearTimeout(a),e("#otp_send_button").css("display","block"),e("#timer").css("visibility","hidden"),e("#otp_send_button").text("Resend")):(e("#timer").css("visibility","visible"),e("#otp_send_button").css("display","none"),e("#timer").text(d),d--)}e("#edit_otp").css("display","inherit"),_(t.message,"green"),c?(s=t.txId,clearInterval(a)):(r=t.txId,d=30),a=setInterval(i,1e3);break;case"FAILED":case"ERROR":_(t.message,"red")}})}function y(i,l,a,r,s){let c={action:"mo_shortcode",mo_action:"validate",otp:i,nonce:l,mobile:a,txId:r,email:s};!1===d&&e.post(t,c,function(t){if(null===t)_("Error Validating OTP","red"),e(o).unbind("submit"),d=!1;else switch(t.status){case"SUCCESS":_(t.message,"green"),d=!0,e(n).removeAttr("disabled"),e(n).prop("disabled",!1),e(o).unbind("submit"),e(n).unbind("click").click();break;case"FAILED":_(t.message,"red"),e(n).removeAttr("disabled"),e(n).prop("disabled",!1);break;case"ERROR":e(n).removeAttr("disabled"),_("Invalid OTP","red"),e(n).prop("disabled",!1)}})}function E(i,o,l,r,p,u){let b={action:"mo_shortcode",mo_action:"validate",otp:i,nonce:o,mobile:l,txId:r,email:p};0==d?u&&e.post(t,b,function(r){if(u=!1,null===r)_("Error Validating OTP","red"),d=!1;else switch(r.status){case"SUCCESS":e(n).removeAttr("disabled"),_(l+" "+r.message+" Sending OTP on "+p,"green"),d=!1,c=!0,setTimeout(function(){x("email",null,p,o,t)},3e3),e("#edit_otp").val(""),e("#edit_otp").css("placeholder","Enter OTP Sent on your email"),e(a).after('<br><p style="color:green;"> Phone Number Validated â˜‘</p>'),e(a).attr("disabled","true"),e(n).text("Register"),e(n).click(function(t){0==d&&(t.preventDefault(),i=e("#edit_otp").val(),y(i,o,l,s,p))});break;case"FAILED":case"ERROR":_(r.message,"red"),e(n).removeAttr("disabled")}}):(_("Already Validated","red"),jQuery.reload())}switch(p){case"phone":if(e(a).after(f+m+h),e(a).intlTelInput({}),!e(a).length){const t='<p id="phoneFieldLabel" style="color: red;font-size: 18px;border: red 1px solid;padding: 5px" > miniOrange : Phone Field not Found.</p>';return void e(l).after("<br>"+t)}e("#otp_send_button").click(function(){u=e(a).val(),u=u.replace(/\s+/g,""),b=e(l).val(),P(u)?O(b)?(c=!1,x(p,u,null,i,t)):e("#otpmessage").text("Invalid Email Address").css("color","red"):e("#otpmessage").text("Invalid Phone Number").css("color","red")}),e(n).click(function(t){t.preventDefault(),!1===d&&(A=e("#edit_otp").val(),A&&r?y(A,i,u,r,b):_("Please Validate Phone first","red")),e(n).unbind("click")}),e(o).on("submit",function(t){if(t.preventDefault(),!1===d){if(A=e("#edit_otp").val(),!A||!r)return _("Please Validate Email first","red"),e(n).prop("disabled",!1),e(n).removeAttr("disabled"),!0;y(A,i,u,r,b)}});break;case"email":if(!e(l).length){const t='<p id="emailFieldLabel" style="color: red;font-size: 18px;border: red 1px solid;padding: 5px" > miniOrange : Email Field '+l+" not Found. Please check Selector</p>";return void(e(o).length?e(o).after("<br>"+t):e(n).length&&e(n).after("<br>"+t))}e(l).after(g+m+h),e("#otp_send_button").click(function(){b=e(l).val(),O(b)&&b?(c=!1,x(p,null,b,i,t)):_("Email Address is Invalid or Empty","red")}),e(n).click(function(t){t.preventDefault(),!1===d&&(A=e("#edit_otp").val(),A&&r?y(A,i,u,r,b):_("Please Validate Email first","red")),e(n).unbind("click")}),e(o).on("submit",function(t){if(t.preventDefault(),!1===d){if(A=e("#edit_otp").val(),!A||!r)return _("Please Validate Email first","red"),e(n).prop("disabled",!1),e(n).removeAttr("disabled"),!0;y(A,i,u,r,b)}});break;case"both":if(e(a).after(v+m+h),e(a).intlTelInput({}),!e(a).length){const t='<p id="phoneFieldLabel" style="color: red;font-size: 18px;border: red 1px solid;padding: 5px" > miniOrange : Phone Field not Found.</p>';return void e(l).after("<br>"+t)}e("#otp_send_button").click(function(){u=e(a).val(),u=u.replace(/\s+/g,""),b=e(l).val(),P(u)?O(b)?(c?(x("email",null,b,i,t),e(n).text("Register"),$(n).removeAttr("disabled")):x("phone",u,null,i,t),e(n).text("Validate")):e("#otpmessage").text("Invalid Email Address").css("color","red"):e("#otpmessage").text("Invalid Phone Number").css("color","red")}),e(n).click(function(t){t.preventDefault(),!1===d&&(A=e("#edit_otp").val(),A&&r?E(A,i,u,r,b,!0):_("Please Validate Email and Phone first","red")),e(n).unbind("click")}),e(o).on("submit",function(t){if(t.preventDefault(),!1===d){if(A=e("#edit_otp").val(),!A||!r)return _("Please Validate Email and Phone first","red"),e(n).prop("disabled",!1),e(n).removeAttr("disabled"),!0;E(A,i,u,r,b)}})}function O(e){let t=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;return t.test(e)}function P(e){let t=/[0-9 -()+]+$/;return!(e.length<10||0===e.length||!t.test(e))}}});